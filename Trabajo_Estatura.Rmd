---
title: 'Punto 2° Parcial: Ajuste de un modelo de R.L.M'
author:
- Daniel Villa 1005087556
- Juan Pablo Vanegas 1000640165
subtitle: |
  | Universidad Nacional de Colombia
  | Analisís de Regresión 2022-1S
  | Medellín, Colombia
  | 2022
output:
  prettydoc::html_pretty:
    theme: cayman
    highlight: github
    df_print: kable
    toc: yes
  toc_float:
    toc_collapsed: yes
    toc_depth: 3
    number_sections: yes
  pdf_document:
    keep_tex: yes
    latex_engine: xelatex
    number_sections: yes
    df_print: kable
header-includes:
- \usepackage{booktabs}
- \usepackage{longtable}
- \usepackage{array}
- \usepackage{multirow}
- \usepackage{wrapfig}
- \usepackage{float}
- \usepackage{colortbl}
- \usepackage{pdflscape}
- \usepackage{tabu}
- \usepackage{threeparttable}
- \usepackage{threeparttablex}
- \usepackage[normalem]{ulem}
- \usepackage{makecell}
- \usepackage{xcolor}
editor_options:
  chunk_output_type: console
---

\centering ![](templates/EscudoUN.png)

\newpage

\tableofcontents

\newpage

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE, warning=FALSE, include=FALSE}
library(readr)
library(tidyverse)
library(kableExtra)
library(magrittr)
library(ggExtra)
library(GGally)
library(janitor)
library(tidystats)
library(car)
library(faraway)
library(lmtest)
library(graphics)
# lectura de la base de datos:
stature <- read_csv("estaturas.csv")
```

# Objetivos:

Crear un modelo ajustado de R.L.M. por el cual se pueda predecir la estatura de un individuo (discrimiando por genero) sabiendo las estaturas de los padres (madre y padre) utilizando el software estadístico *R*.

## Objetivos específicos

-   Plantear el modelo de R.L.M.

-   Interpretar los parámetros del modelo.

-   Determinar si el efecto de las estaturas de los padres sobre la estatura del sujeto es significativo.

-   Interpretar nuestro $R^2$.

-   Validar los supuestos del modelo.

-   Aplicar la prueba de falta de ajuste.


# Antecedentes Relevantes

La población encuestada, pertenece a estudiantes de la Universidad Nacional de Colombia sede Medellín de diferentes carreras, es decir, la mayoria de los sujetos de la muestra son jovenes entre los 18 y los 25 años, además decidimos que solamente aquellos que tenian la posibilidad de saber las estaturas de sus padres entraban a nuestra base de datos, ya que el porceso sería más arduo si tomamos datos donde nos faltan llenar valores en las celdas correspondientes.


# Variables de respuesta:

En nuestro caso será la estatura del sujeto (Hombre o Mujer) para ajustar un modelo para predecir por medio de nuestras variables predictoras la esturura del sujeto.

# Variable de Control:

En este caso tendremos 3 varibles haciendo de este un modelo de R.L.M.

1. Estatura del Padre.
2. Estatura del Madre.
3. Genero del sujeto.

# Creación del Modelo

Nuestro modelo tendra la forma de:

$Y_i = \beta_0 + \beta_1X_{i1} + \beta_2X_{i2} + \beta_3X_{i3}+\varepsilon_i, \ i=1,...,30 \ \ donde \ \varepsilon_i \sim N(0,\sigma^2)$

Para llegar a lo anterior primero miraremos nuestra base de datos y como se comportan estas variables *(algunos datos...)*.

```{r echo=FALSE, message=FALSE, warning=FALSE}
kable(rbind(head(stature, n = 5),rep(".", ncol(stature)),
            rep(".", ncol(stature)),rep(".", ncol(stature)),
            tail(stature, n = 5)),digits = 30, align = "c")
```

Definimos nuestras variables:

- `est_sujeto`: Estatura en cm del sujeto encuestado.

- `genero`: Genero del sujeto encuestado.

- `exp_sujeto`: Fecha de expedición de la cedula del sujeto.

- `est_madre`: Estatura de la madre del sujeto en cm.

- `est_padre`: Estatura del padre del sujeto en cm.

- `ced_sujeto`: Ultimos cuatro dijitos de la cedula del sujeto encuestado.

- `ced_madre`: Ultimos cuatro dijitos de la cedula de la madre.

- `ced_padre`: Ultimos cuatro dijitos de la cedula del padre.

- `exp_madre`: Fecha de expedición de la cedula de la madre.

- `exp_padre`: Fecha de expedición de la cedula del padre.

# Análisis de correlación

Comenzamos representando los datos en una nube de puntos múltiple, donde vemos la relación entre cada par de variables.

```{r echo=FALSE, message=FALSE, warning=FALSE}
stature$genero %<>% as.factor()
stature$exp_sujeto %<>% as.Date(format="%d/%m/%Y")
stature$exp_padre %<>% as.Date(format="%d/%m/%Y")
stature$exp_madre %<>% as.Date(format="%d/%m/%Y")
stature$ced_madre %<>%  as.character()
stature %>% ggpairs(.,columns=c(1,2,4,5), aes(color=genero,alpha=0.5))
```


```{r message=FALSE, warning=FALSE, include=FALSE}
colnames(stature) <- c("est","genero","exp","est_ma","est_pa","ced",
                         "ced_ma","ced_pa","exp_pa","exp_ma")
```

Según la sigueinte tabla veremos que tan debil o fuerte son los datos respecto a otros:

![corr_guide](templates/corr_guide.jpg)

como podemos apreciar nuestras 3 correlaciones entre cada variable predictora y nuestra $Y$ es una *Correlación Negativa débil* ya que ninguno supera $\pm 0.5$.

# Ajuste del modelo

```{r}
modelo.m <- lm(est ~ est_pa + est_ma + genero, data = stature)
summary(modelo.m)
```

El error típico residual es `11.2`, la $R^2=0.3025$, aunque para el modelo múltiple es mejor fijarnos en su valor ajustado $R_a^2=0.222$. Esto que significa que la recta de regresión explica el 22.22% de la variabilidad del modelo. Además, `F = 3.758` con una significación $p<0.05$, lo que nos dice que nuestro modelo de regresión resulta un poco mejor que el modelo básico.

# Comparación de modelos

Pretendemos seleccionar el “mejor” subconjunto de predictores por varias razones: 

1. Explicar los datos de la manera más simple. Debemos eliminar predictores redundantes.

2. Predictores innecesarios añade ruido a las estimaciones.

3. La causa de la multicolinealidad es tener demasiadas variables tratando de hacer el mismo trabajo. Eliminar el exceso de predictores ayuda a la interpretación del modelo.

4. Si vamos a utilizar el modelo para la predicción, podemos ahorrar tiempo y/o dinero al no medir predictores redundantes.

Puesto que tenemos dos variables explicativas disponemos de 6 modelos posibles:

$modelo \ 1: \ est \sim est_{ma}+est_{pa}+genero$

$modelo \ 2: \ est \sim est_{ma}+genero$

$modelo \ 3: \ est \sim est_{pa}+genero$

$modelo \ 4: \ est \sim est_{ma}$

$modelo \ 5: \ est \sim est_{pa}$

$modelo \ 6: \ est \sim genero$

Vamos a ajustar cada uno de los modelos

```{r echo=FALSE, message=FALSE, warning=FALSE}
modelo2 <- lm(est~est_ma+genero, data=stature)
modelo3 <- lm(est~est_pa+genero, data=stature)
modelo4 <- lm(est~est_ma, data=stature)
modelo5 <- lm(est~est_pa, data=stature)
modelo6 <- lm(est~genero, data=stature)

summary(modelo2)
summary(modelo3)
summary(modelo4)
summary(modelo5)
summary(modelo6)
```












